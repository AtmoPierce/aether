@startuml MPC_Architecture
' ==== Layout & Theme ====
top to bottom direction
skinparam linetype ortho
skinparam backgroundColor #0B0C10
skinparam defaultTextAlignment center
skinparam componentStyle rectangle
skinparam shadowing false
skinparam nodesep 80
skinparam ranksep 100
skinparam rectangle {
  BorderColor #66FCF1
  FontColor white
  FontSize 14
  RoundCorner 15
  LineThickness 1.5
}
skinparam package {
  BorderColor #45A29E
  BackgroundColor #1F2833
  FontColor #66FCF1
  FontSize 16
}
skinparam titleFontColor #66FCF1
skinparam arrow {
  Color #C5C6C7
  FontColor #C5C6C7
  Thickness 1.2
}

title Model Predictive Control â€“ Aether Project (Three-Tier Architecture)

' ==== Applications (TOP) ====
package "Applications" {
  component "Telegraph\n(3D Visualization & UI)" as TELE
  component "Astrum\n(MPC Orchestrator)" as AST
  component "CrabPilot\n(Physics / Plant Sim)" as CRAB
  component "Navis Avionics\n(Embedded Runtime)" as NAV
  TELE -[hidden]-> AST
  AST -[hidden]-> CRAB
  CRAB -[hidden]-> NAV
}

' ==== Core Libraries (MIDDLE) ====
package "Core Libraries" {
  component "Aether\n(Ref Frames / Math / DCM / Quat)" as AETH
  component "CUDA MPC Lib\n(Batched Riccati / DARE / DRE)" as CUDALIB
  component "Aether API Bus" as AETHER_BUS
  AETH -[hidden]-> CUDALIB
}

' ==== HPC & Infrastructure (BOTTOM) ====
package "HPC & Infrastructure" {
  component "Forgejo / Gitea\n(Code + Artifacts)" as GIT
  component "CI / Actions Runners" as CI
  component "PBS / Slurm\n(Job Scheduler)" as SCHED
  component "GPU Nodes\n(cuBLAS / cuSolver)" as GPU
  component "Timing / Power CSV" as CSV
  component "Nsight / Metrics Dashboard" as NSIGHT
  component "HPC Job Bus" as HPC_BUS
  component "Metrics Bus" as METRICS_BUS
  GIT -[hidden]-> CI
  CI -[hidden]-> SCHED
  SCHED -[hidden]-> GPU
  GPU -[hidden]-> CSV
  CSV -[hidden]-> NSIGHT
}

' ==== Connections ====

' Applications -> Libraries
TELE -down-> AETHER_BUS
AST  -down-> AETHER_BUS
CRAB -down-> AETHER_BUS
NAV  -down-> AETHER_BUS
AETHER_BUS -down-> AETH

' Astrum -> CUDA
AST -down-> CUDALIB

' Libraries -> Infrastructure
CUDALIB -down-> GPU
AETH -down-> GPU

' Job / CI pipeline
AST -down-> HPC_BUS
CI -down-> HPC_BUS
HPC_BUS -down-> SCHED
SCHED -down-> GPU

' Repo -> CI
GIT -down-> CI

' Metrics flow
AST -down-> METRICS_BUS
GPU -down-> METRICS_BUS
METRICS_BUS -down-> CSV
CSV -down-> NSIGHT

' Visualization reads metrics
TELE -right-> CSV : load metrics

' Sim & embedded telemetry
CRAB -right-> AST : state / constraints
NAV  -left-> AST : HIL / telemetry

@enduml
